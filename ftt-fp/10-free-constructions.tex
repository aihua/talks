\batchmode
\makeatletter
\def\input@path{{/Users/sergei.winitzki/Code/talks/ftt-fp/}}
\makeatother
\documentclass[english,,russian]{beamer}
\usepackage[T2A,T1]{fontenc}
\usepackage[utf8]{inputenc}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\usepackage{babel}
\usepackage{tipa}
\usepackage{tipx}
\usepackage{amsmath}
\ifx\hypersetup\undefined
  \AtBeginDocument{%
    \hypersetup{unicode=true,pdfusetitle,
 bookmarks=true,bookmarksnumbered=false,bookmarksopen=false,
 breaklinks=false,pdfborder={0 0 1},backref=false,colorlinks=true}
  }
\else
  \hypersetup{unicode=true,pdfusetitle,
 bookmarks=true,bookmarksnumbered=false,bookmarksopen=false,
 breaklinks=false,pdfborder={0 0 1},backref=false,colorlinks=true}
\fi

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\DeclareRobustCommand{\cyrtext}{%
  \fontencoding{T2A}\selectfont\def\encodingdefault{T2A}}
\DeclareRobustCommand{\textcyr}[1]{\leavevmode{\cyrtext #1}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Textclass specific LaTeX commands.
% this default might be overridden by plain title style
\newcommand\makebeamertitle{\frame{\maketitle}}%
% (ERT) argument for the TOC
\AtBeginDocument{%
  \let\origtableofcontents=\tableofcontents
  \def\tableofcontents{\@ifnextchar[{\origtableofcontents}{\gobbletableofcontents}}
  \def\gobbletableofcontents#1{\origtableofcontents}
}
\newenvironment{lyxcode}
  {\par\begin{list}{}{
    \setlength{\rightmargin}{\leftmargin}
    \setlength{\listparindent}{0pt}% needed for AMS classes
    \raggedright
    \setlength{\itemsep}{0pt}
    \setlength{\parsep}{0pt}
    \normalfont\ttfamily}%
   \def\{{\char`\{}
   \def\}{\char`\}}
   \def\textasciitilde{\char`\~}
   \item[]}
  {\end{list}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\usetheme[secheader]{Boadilla}
\usecolortheme{seahorse}
\title[Chapter 10: Free type constructions]{Chapter 10: Free type constructions}
%\subtitle{Part 2: Their laws and structure}
\author{Sergei Winitzki}
\date{2018-11-22}
\institute[ABTB]{Academy by the Bay}
\setbeamertemplate{headline}{} % disable headline at top
\setbeamertemplate{navigation symbols}{} % disable navigation bar at bottom
\usepackage[all]{xy}
\usepackage[nocenter]{qtree}
\makeatletter
% Macros to assist LyX with XYpic when using scaling.
\newcommand{\xyScaleX}[1]{%
\makeatletter
\xydef@\xymatrixcolsep@{#1}
\makeatother
} % end of \xyScaleX
\makeatletter
\newcommand{\xyScaleY}[1]{%
\makeatletter
\xydef@\xymatrixrowsep@{#1}
\makeatother
} % end of \xyScaleY
\newcommand{\shui}{\begin{CJK}{UTF8}{gbsn}æ°´\end{CJK}}
\usepackage{CJKutf8} % For occasional Chinese characters. Also, add "russian" to documentclass.

\makeatother

\begin{document}
\frame{\titlepage}
\begin{frame}{The interpreter pattern I. Expression trees}

Main idea: Represent a program as a data structure, run it later
\begin{itemize}
\item Example: a simple DSL for complex numbers
\end{itemize}
\vspace{-0.35cm}%
\begin{minipage}[t]{0.35\columnwidth}%
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}val~a~=~\textquotedbl 1+2{*}i\textquotedbl .toComplex}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}val~b~=~a~{*}~\textquotedbl 3-4{*}i\textquotedbl .toComplex}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}b.conj}{\footnotesize\par}
\end{lyxcode}
%
\end{minipage}\hspace*{\fill}%
\begin{minipage}[t]{0.45\columnwidth}%
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}Conj(}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~Mul(}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~Str(\textquotedbl 1+2{*}i\textquotedbl ),~Str(\textquotedbl 3-4{*}i\textquotedbl )}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}))}{\footnotesize\par}
\end{lyxcode}
%
\end{minipage}\hspace*{\fill}
\begin{itemize}
\item \emph{Unevaluated} operations \texttt{\textcolor{blue}{\footnotesize{}Str}},
\texttt{\textcolor{blue}{\footnotesize{}Mul}}, \texttt{\textcolor{blue}{\footnotesize{}Conj}}
are defined as case classes:
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}sealed~trait~Prg}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Str(s:~String)~extends~Prg}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Mul(p1:~Prg,~p2:~Prg)~extends~Prg}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Conj(p:~Prg)~extends~Prg}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item An \emph{interpreter} will ``run'' the program and return a complex
number
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}def~run(prg:~Prg):~(Double,~Double)~=~...}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item Benefits: programs are data, can compose \& transform before running
\item Shortcomings: this DSL works only with simple expressions
\begin{itemize}
\item Cannot represent variable binding and conditional computations
\item Cannot use any non-DSL code (e.g.~a numerical algorithms library)
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{The interpreter pattern II. Variable binding}

\vspace{-0.1cm}A DSL with variable binding and conditional computations
\begin{itemize}
\item Example: imperative API for reading and writing files
\begin{itemize}
\item Need to bind a \emph{non-DSL variable} to a value computed by DSL
\item Later, need to use that non-DSL variable in DSL expressions
\end{itemize}
\item The rest of the DSL program is a (Scala) function of that variable
\end{itemize}
\vspace{-0.15cm}%
\begin{minipage}[t]{0.35\columnwidth}%
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}val~p~=~path(\textquotedbl /file\textquotedbl )}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}val~str:~String~=~read(p)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}if~(str.nonEmpty)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~read(path(str))}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}else~\textquotedbl Error:~empty~path\textquotedbl}{\footnotesize\par}
\end{lyxcode}
%
\end{minipage}\hspace*{\fill}%
\begin{minipage}[t]{0.45\columnwidth}%
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}Bind(}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~Read(Path(Literal(\textquotedbl /file\textquotedbl ))),}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~\{~str~$\Rightarrow$}\textcolor{darkgray}{\footnotesize{}~//~read~value~`str`}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~if~(str.nonEmpty)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~~~Read(Path(Literal(str)))}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~else~Literal(\textquotedbl Error:~empty~path\textquotedbl )}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~\})}{\footnotesize\par}
\end{lyxcode}
%
\end{minipage}\hspace*{\fill}
\begin{itemize}
\item \vspace{0.1cm}Unevaluated operations are implemented via case classes:
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}sealed~trait~Prg}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Bind(p:~Prg,~f:~String~$\Rightarrow$~Prg)~extends~Prg~}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Literal(s:~String)~extends~Prg~}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Path(s:~Prg)~extends~Prg}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Read(p:~Prg)~extends~Prg}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item \vspace{-0.1cm}Interpreter: \texttt{\textcolor{blue}{\footnotesize{}def
run(prg: Prg): String = ...}} 
\end{itemize}
\end{frame}

\begin{frame}{The interpreter pattern III. Type safety}
\begin{itemize}
\item So far, the DSL has no type safety: every value is a \texttt{\textcolor{blue}{\footnotesize{}Prg}} 
\item We want to avoid errors, e.g. \texttt{\textcolor{blue}{\footnotesize{}Read(Read(...))}}
should not compile
\item Let \texttt{\textcolor{blue}{\footnotesize{}Prg{[}A{]}}} denote a
DSL program returning value of type \texttt{\textcolor{blue}{\footnotesize{}A}}
\emph{when run}:
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}sealed~trait~Prg{[}A{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Bind(p:~Prg{[}String{]},~f:~String~$\Rightarrow$~Prg{[}String{]})}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~extends~Prg{[}String{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Literal(s:~String)~extends~Prg{[}String{]}~}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Path(s:~Prg{[}String{]})~extends~Prg{[}nio.file.Path{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Read(p:~Prg{[}nio.file.Path{]})~extends~Prg{[}String{]}}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item Interpreter: \texttt{\textcolor{blue}{\footnotesize{}def run(prg: Prg{[}String{]}): String
= ...}}{\footnotesize\par}
\item Our example DSL program is type-safe now:
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}val~prg:~Prg{[}String{]}~=~Bind(}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~Read(Path(Literal(\textquotedbl /file\textquotedbl ))),}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~~\{~str:~String~$\Rightarrow$}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~if~(str.nonEmpty)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~~~Read(Path(Literal(str)))}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~~~else~Literal(\textquotedbl Error:~empty~path\textquotedbl )}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~\})}{\footnotesize\par}
\end{lyxcode}
\end{frame}

\begin{frame}{The interpreter pattern IV. Cleaning up the DSL}

\vspace{-0.15cm}Our DSL so far:
\begin{lyxcode}
\vspace{-0.35cm}\textcolor{blue}{\footnotesize{}sealed~trait~Prg{[}A{]}~\{~def~bind(f:~String$\Rightarrow$Prg{[}String{]}):~Prg{[}String{]}~\}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Path(s:~Prg{[}String{]})~extends~Prg{[}nio.file.Path{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Read(p:~Prg{[}nio.file.Path{]})~extends~Prg{[}String{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Literal(s:~String)~extends~Prg{[}String{]}}{\footnotesize\par}
\end{lyxcode}
Problems with this DSL:
\begin{itemize}
\item Cannot use \texttt{\textcolor{blue}{\footnotesize{}Read(p: nio.file.Path)}},
only \texttt{\textcolor{blue}{\footnotesize{}Read(p: Prg{[}nio.file.Path{]})}} 
\item Cannot bind variables or return values other than \texttt{\textcolor{blue}{\footnotesize{}String}} 
\end{itemize}
To fix these problems:
\begin{itemize}
\item Promote \texttt{\textcolor{blue}{\footnotesize{}Literal}} to a fully
parameterized operation
\item Replace \texttt{\textcolor{blue}{\footnotesize{}Prg{[}A{]}}} by \texttt{\textcolor{blue}{\footnotesize{}A}}
in case class arguments
\end{itemize}
Resulting DSL:
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}sealed~trait~Prg{[}A{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Bind{[}A,~B{]}(p:~Prg{[}A{]},~f:~A$\Rightarrow$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \shui$\cdot$Ñ$\cdot$\shui$\cdot$Ñ
\end{itemize}
How to represent this as a data type:
\begin{itemize}
\item Tree encoding: the full expression tree: ((\shui,\shui),(Ñ,\shui)),Ñ)
\begin{itemize}
\item Implement the operation $a\cdot b$ as pair constructor (easy)
\end{itemize}
\item Reduced encoding, as a ``smart'' structure: List(\shui,\shui,Ñ,\shui,Ñ)
\begin{itemize}
\item Implement $a\cdot b$ by concatenating the lists (more expensive)
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Free constructions in mathematics: Example II}
\begin{itemize}
\item Want to define a product operation for $n$-dimensional vectors: $\mathbf{v}_{1}\otimes\mathbf{v}_{2}$
\item The $\otimes$ must be linear and distributive (but not commutative):
\begin{align*}
\mathbf{u}_{1}\otimes\mathbf{v}_{1}+\left(\mathbf{u}_{2}\otimes\mathbf{v}_{2}+\mathbf{u}_{3}\otimes\mathbf{v}_{3}\right) & =\left(\mathbf{u}_{1}\otimes\mathbf{v}_{1}+\mathbf{u}_{2}\otimes\mathbf{v}_{2}\right)+\mathbf{u}_{3}\otimes\mathbf{v}_{3}\\
\mathbf{u}\otimes\left(a_{1}\mathbf{v}_{1}+a_{2}\mathbf{v}_{2}\right) & =a_{1}\left(\mathbf{u}\otimes\mathbf{v}_{1}\right)+a_{2}\left(\mathbf{u}\otimes\mathbf{v}_{2}\right)\\
\left(a_{1}\mathbf{v}_{1}+a_{2}\mathbf{v}_{2}\right) & \otimes\mathbf{u}=a_{1}\left(\mathbf{v}_{1}\otimes\mathbf{u}\right)+a_{2}\left(\mathbf{v}_{2}\otimes\mathbf{u}\right)
\end{align*}

\begin{itemize}
\item We have such a product for 3-dimensional vectors only; ignore that
\end{itemize}
\item Consider \emph{unevaluated} \emph{expressions} of the form $\mathbf{u}_{1}\otimes\mathbf{v}_{1}+\mathbf{u}_{2}\otimes\mathbf{v}_{2}+...$
\begin{itemize}
\item A free vector space generated by pairs of vectors
\end{itemize}
\item Impose the equivalence relationships shown above
\begin{itemize}
\item The result is known as the \textbf{tensor product}
\end{itemize}
\item Tree encoding: full unevaluated expression tree
\begin{itemize}
\item A list of any number of vector pairs $\sum_{i}\mathbf{u}_{i}\otimes\mathbf{v}_{i}$
\end{itemize}
\item Reduced encoding: a matrix
\begin{itemize}
\item Reduced encoding requires proof and more complex operations
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Worked example: Free semigroup}

{\footnotesize{}\vspace{-0.15cm}}Implement a free semigroup \texttt{\textcolor{blue}{\footnotesize{}FSIS}}
generated by two types \texttt{\textcolor{blue}{\footnotesize{}Int}}
and \texttt{\textcolor{blue}{\footnotesize{}String}} 
\begin{itemize}
\item A value of \texttt{\textcolor{blue}{\footnotesize{}FSIS}} can be an
\texttt{\textcolor{blue}{\footnotesize{}Int}}; it can also be a \texttt{\textcolor{blue}{\footnotesize{}String}} 
\item If \texttt{\textcolor{blue}{\footnotesize{}x}}, \texttt{\textcolor{blue}{\footnotesize{}y}}
are of type \texttt{\textcolor{blue}{\footnotesize{}FSIS}} then so
is \texttt{\textcolor{blue}{\footnotesize{}Mul(x, y)}} 
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}sealed~trait~FSIS~}\textcolor{darkgray}{\footnotesize{}//~tree~encoding:~full~expression~tree}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Wrap1(x:~Int)~extends~FSIS}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Wrap2(x:~String)~extends~FSIS}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Mul(x:~FSIS,~y:~FSIS)~extends~FSIS}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item {\footnotesize{}\vspace{-0.15cm}}Short type notation: $\text{FSIS}\equiv\text{Int}+\text{String}+\text{FSIS}\times\text{FSIS}$ 
\item For a semigroup $S$ and given $\text{Int}\Rightarrow S$ and $\text{String}\Rightarrow S$,
map $\text{FSIS}\Rightarrow S$
\item Simplify and generalize this construction by setting $Z=\text{Int}+\text{String}$
\item The redundant encoding is $\text{FS}^{Z}=Z+\text{FS}^{Z}\times\text{FS}^{Z}$
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}def~mul(x:~FS{[}Z{]},~y:~FS{[}Z{]}):~FS{[}Z{]}~=~Mul(x,~y)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}def~run{[}S:~Semigroup,~Z{]}(extract:~Z~$\Rightarrow$~S):~FS{[}Z{]}~$\Rightarrow$~S~=~\{}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~case~F(z)~$\Rightarrow$~extract(z)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~case~Mul(x,~y)~$\Rightarrow$~run(extract)(x)~|+|~run(extract)(y)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}\}~}\textcolor{darkgray}{\footnotesize{}//~Semigroup~laws~will~hold~after~applying~run().}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item {\footnotesize{}\vspace{-0.15cm}}The reduced encoding is $\text{FSR}^{Z}\equiv Z\times\text{List}^{Z}$
(non-empty list of $Z$'s)
\begin{itemize}
\item \texttt{\textcolor{blue}{\footnotesize{}Mul(x, y)}} requires concatenating
the lists but \texttt{\textcolor{blue}{\footnotesize{}run()}} is faster
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Worked example: Free monoid}

{\footnotesize{}\vspace{-0.15cm}}Implement a free monoid \texttt{\textcolor{blue}{\footnotesize{}FM{[}Z{]}}}
generated by type \texttt{\textcolor{blue}{\footnotesize{}Z}} 
\begin{itemize}
\item A value of \texttt{\textcolor{blue}{\footnotesize{}FM{[}Z{]}}} can
be the empty value; it can also be a \texttt{\textcolor{blue}{\footnotesize{}Z}} 
\item If \texttt{\textcolor{blue}{\footnotesize{}x}}, \texttt{\textcolor{blue}{\footnotesize{}y}}
are of type \texttt{\textcolor{blue}{\footnotesize{}FM{[}Z{]}}} then
so is \texttt{\textcolor{blue}{\footnotesize{}Mul(x, y)}} 
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}sealed~trait~FM{[}Z{]}~}\textcolor{darkgray}{\footnotesize{}//~tree~encoding}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Empty{[}Z{]}()~extends~FM{[}Z{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Wrap{[}Z{]}(z:~Z)~extends~FM{[}Z{]}}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}case~class~Mul{[}Z{]}(x:~FM{[}Z{]},~y:~FM{[}Z{]})~extends~FM{[}Z{]}}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item {\footnotesize{}\vspace{-0.15cm}}Short type notation: $\text{FM}^{Z}\equiv1+Z+\text{FM}^{Z}\times\text{FM}^{Z}$ 
\item For a monoid $M$ and given $Z\Rightarrow M$, map $\text{FM}^{Z}\Rightarrow M$
\end{itemize}
\begin{lyxcode}
\textcolor{blue}{\footnotesize{}def~mul(x:~FM{[}Z{]},~y:~FM{[}Z{]}):~FM{[}Z{]}~=~Mul(x,~y)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}def~run{[}M:~Monoid,~Z{]}(extract:~Z~$\Rightarrow$~M):~FM{[}Z{]}~$\Rightarrow$~M~=~\{}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~case~Empty()~$\Rightarrow$~Monoid{[}M{]}.empty}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~case~Wrap(z)~$\Rightarrow$~extract(z)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}~~case~Mul(x,~y)~$\Rightarrow$~run(extract)(x)~|+|~run(extract)(y)}{\footnotesize\par}

\textcolor{blue}{\footnotesize{}\}~}\textcolor{darkgray}{\footnotesize{}//~Monoid~laws~will~hold~after~applying~run().}{\footnotesize\par}
\end{lyxcode}
\begin{itemize}
\item {\footnotesize{}\vspace{-0.15cm}}The reduced encoding is $\text{FMR}^{Z}\equiv\text{List}^{Z}$
(list of $Z$'s)
\begin{itemize}
\item The multiplication requires concatenating the lists 
\end{itemize}
\item Reduced encoding and tree encodings give identical results after \texttt{\textcolor{blue}{\footnotesize{}run()}} 
\end{itemize}
\end{frame}

\begin{frame}{Exercises}
\begin{enumerate}
\item {\footnotesize{}\vspace{-0.15cm}Implement a free semigroup generated
by a type parameter $Z$ in the tree encoding and in the reduced encoding.
Show that the semigroup laws hold for the reduced encoding but not
for the tree encoding before interpreting into a lawful semigroup
$S$.}{\footnotesize\par}
\end{enumerate}
\end{frame}

\end{document}
